# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Purpose

This repository contains **published assets for Discrete Cortical Networks (DCC) illustrations, demos, and communications**. It serves as a distribution hub for interactive visualizations and simulations of DCC-based neural network demonstrations that can be embedded in various platforms and web applications.

The main purpose is to provide shareable, embeddable viewers that allow users to interact with DCC network simulations through a web browser interface.

---

## Project Structure

The repository follows a versioned approach with two main deployment instances:

```
dcc-public/
├── README.md                          # Project root documentation
├── embedded_dcc_viewer_v1/            # Version 1 - Original embedded viewer
│   ├── README.md                      # V1-specific setup instructions
│   ├── embed.html                     # Embeddable iframe entry point
│   ├── vite.svg                       # Vite build tool icon
│   └── assets/                        # Compiled/built assets
│       ├── dcc_wasm_bg-*.wasm         # WASM binary (DCC runtime)
│       ├── embed-*.js                 # Main embed application bundle
│       ├── useExecutionLoop-*.js      # Shared execution loop logic
│       └── *.css                      # Compiled stylesheets
│
└── embedded_dcc_viewer_v2/            # Version 2 - Enhanced viewer with dashboard
    ├── README.md                      # V2-specific setup (if exists)
    ├── embed.html                     # Embeddable iframe entry point
    ├── index.html                     # Full dashboard/standalone entry point
    ├── vite.svg                       # Vite build tool icon
    └── assets/                        # Compiled/built assets
        ├── dcc_wasm_bg-*.wasm         # WASM binary (same runtime)
        ├── embed-*.js                 # Embed-mode entry point
        ├── main-*.js                  # Full dashboard entry point
        ├── useExecutionLoop-*.js      # Shared execution loop logic
        └── *.css                      # Compiled stylesheets
```

### Directory Size Reference
- `embedded_dcc_viewer_v1/`: ~3.0 MB (total)
- `embedded_dcc_viewer_v2/`: ~3.0 MB (total)

Each viewer is self-contained and can be served independently from a static hosting service (like GitHub Pages).

---

## Architecture Overview

### Source vs. Built Assets Distinction

This repository **contains only built/compiled assets** - it is a distribution/deployment repository, not a source code repository:

- **No source code**: There are no TypeScript/JavaScript source files (.ts, .tsx, .jsx) in this repository
- **Only compiled bundles**: All code in the `assets/` directories consists of:
  - Minified and obfuscated JavaScript bundles
  - Compiled CSS stylesheets  
  - WASM (WebAssembly) binary module
  - Hash-based filenames generated by Vite build tool

- **HTML entry points**: Both `embed.html` and `index.html` (v2 only) contain `<script>` tags that reference the hashed asset files

This is an intentional design pattern - the repository is meant for **distribution and embedding**, not for development of new features.

### Build Tool: Vite

The presence of `vite.svg` files and hash-based asset names (e.g., `embed-xehbpcGE.js`) indicates that the source code was built using **Vite**, a modern JavaScript build tool. 

**Vite build characteristics observed**:
- Hash-based asset naming for cache busting
- Code splitting with modulepreload links
- Separate CSS files with hash naming
- Relative asset paths (as indicated by recent git commits about "relative path")

Git commit history shows build iterations:
```
9355f29 updated vite build with relative path
67e7bae manually fixed asset paths
46cd0160 updated vite build with relative base path
```

---

## Key Technologies Used

### 1. **WebAssembly (WASM)**
- **File**: `dcc_wasm_bg-CLfXBrl-.wasm` (~848 KB)
- **Purpose**: Core DCC simulation engine written in a compiled language (likely Rust based on naming convention `dcc_wasm_bg`)
- **Function**: Executes the actual neural network computations
- **Shared**: Same WASM binary used in both v1 and v2

### 2. **React**
- **Evidence**: React imports and JSX patterns visible in compiled JavaScript
- **Purpose**: UI framework for interactive viewer components
- **Features**: State management, hooks (useState, useEffect), component composition

### 3. **JavaScript Bundling & Module System**
- **ES Modules**: Code uses import/export and modulepreload patterns
- **Code Splitting**: Separate bundles for different concerns (embed vs. main app)
- **Minification**: Production-optimized bundles with name mangling

### 4. **State Management**
- **Evidence**: Zustand-based stores visible in compiled code (devtools middleware patterns)
- **Key Stores**:
  - `ExecutionStore`: WASM ready state, running state, execution step counter, speed, learning toggle
  - `NetworkStore`: Network nodes, edges, history (undo/redo support)
  - `TimeSeriesStore`: Data point tracking with max history
  - `BitFieldStore`: Binary state tracking for network cells
  - `NetworkUIStore`: Pan/zoom and layout operations

### 5. **Styling**
- **CSS Files**: Generated and compiled (~75 KB for v1, ~42 KB for v2)
- **Approach**: Likely component-scoped or utility-based CSS

### 6. **Data Structures**
- **Supports**: 
  - Vector/array data (encoded scalars batch)
  - Graph structures (nodes and edges for network visualization)
  - Time-series data storage
  - Bitfield/binary state representation

---

## Viewer Versions Comparison

### Version 1 (embedded_dcc_viewer_v1)
- **Purpose**: Basic embeddable viewer for single demo selection
- **Entry Point**: `embed.html`
- **Features**:
  - Single demo at a time via URL parameter (`?demo=simpleEncoder`)
  - Basic controls (Play, Step, Stop, Reset)
  - Learning toggle
  - Speed slider
  - Simple iframe-embeddable design
- **Size**: ~3.0 MB total
- **Use Case**: Simple integration into documentation/posts

### Version 2 (embedded_dcc_viewer_v2)
- **Purpose**: Enhanced viewer with full dashboard capabilities
- **Entry Points**: 
  - `embed.html` - Embeddable iframe mode (same as v1)
  - `index.html` - Full standalone dashboard
- **Features** (inferred from asset sizes and naming):
  - Full dashboard with multiple views
  - Network visualization (nodes/edges, presumably with React Flow)
  - Time-series data visualization
  - Encoder comparison demo (newer feature from git history)
  - More sophisticated UI layout
- **Size**: ~3.0 MB total (similar due to shared WASM)
- **Use Case**: Standalone application or embedded with richer interactions
- **Recent Enhancement**: Added encoder comparison demo and full dashboard UI

Git history note:
```
0ebd1d9 updated dcc viewer with full dashboard and added encoder comparison demo
```

---

## Demo System

### How Demos Work

Demos are **initialized via URL parameters** passed to the HTML entry points:

```html
<!-- Example from v1 README -->
https://jacobeverist.github.io/dcc-public/embedded_dcc_viewer_v1/embed.html?demo=simpleEncoder
```

The query parameter `?demo=<demo-name>` tells the viewer which demo configuration to load.

### Available Demos

Based on code analysis and documentation:

1. **simpleEncoder** - Basic scalar encoder demonstration
   - Mentioned in README and README titles
   - Default or common demo

2. **sequence** - Sequence learning demonstration
   - Appears as default fallback in code (`?demo=sequence`)
   - Pattern/temporal sequence learning

3. **encoderComparison** - Encoder comparison demo
   - Added in the v2 update
   - Shows different encoding approaches side-by-side

### Demo Initialization Flow

1. **URL parsed**: JavaScript extracts `?demo=X` from URL
2. **Validation**: Checks if demo name exists in available demos
3. **WASM Ready**: Waits for WebAssembly module to load
4. **Network Creation**: Instantiates new WASM network via `createWasmNetwork()`
5. **Configuration**: Applies demo-specific block configuration
6. **Rendering**: Visualizes network in React Flow based on nodes/edges
7. **Execution Ready**: User can start, step, or reset the simulation

### Demo-Related Components

Visible in compiled code:
- `EmbeddableControls` - Control panel with play/pause/reset/speed
- `EmbeddableApp` - Main container component
- `initializeDemo()` - Initialization function for setting up demos
- Demo selection UI with error handling for invalid demos

---

## Build and Development Processes (Inferred)

### Build Chain

While source code is not in this repository, the build artifacts indicate this process:

```
TypeScript/JavaScript Source Code
           ↓
      Vite Build
           ↓
    Code Splitting
    (embed, main, useExecutionLoop)
           ↓
    Hash-based naming
    (cache busting)
           ↓
    Minification & Obfuscation
           ↓
    Output to assets/
```

### Build Output Organization

The build produces three main JavaScript bundles:

1. **embed-*.js** (~4.4 KB v1, ~4.4 KB v2)
   - Entry point for embedded iframe mode
   - Initializes EmbeddableApp component
   - Loads demo from URL parameters

2. **main-*.js** (v2 only, ~39.7 KB)
   - Entry point for full dashboard
   - Includes additional dashboard-specific components
   - Larger due to more UI features

3. **useExecutionLoop-*.js** (~2.1 MB v1, ~2.1 MB v2)
   - Shared execution loop and state management
   - Contains all React components
   - Contains all Zustand stores
   - Contains WASM bindings and interface code
   - Shared by both embed and main modes

### Asset Version Management

Recent commits show development of asset path handling:

```
9355f29 updated vite build with relative path
67e7bae manually fixed asset paths  
46cd0160 updated vite build with relative base path
1bd53aa changed relative link to assets
```

This indicates:
- Asset paths needed careful configuration for GitHub Pages hosting
- Relative vs. absolute path decisions made during deployment
- Possible issues with asset references in iframe contexts

### Speed Configuration

Git history shows speed tuning:
```
03664bd changed default speed to 10Hz
```

This corresponds to code that converts between step timing and execution speed:
- Default 500ms step time visible in compiled code
- Converted to ~10 Hz execution frequency (100ms per step)
- Quadratic scaling applied to UI slider for better UX

---

## Embedding Guide

### Standard iframe Embedding

The v1 README provides clear embedding instructions:

```html
<div class="iframe-wrapper">
    <iframe
        src="https://jacobeverist.github.io/dcc-public/embedded_dcc_viewer_v1/embed.html?demo=simpleEncoder"
        title="DCC Network Viewer"
        allow="wasm-eval"
        width="850"
        height="600">
    </iframe>
</div>
```

**Key attributes**:
- `allow="wasm-eval"` - Required for WebAssembly execution in iframe
- `?demo=simpleEncoder` - Selects which demo to display
- Dimensions: 850x600 recommended (responsive layout in viewer)

### Platform-Specific Instructions

#### Discourse Forum Integration

1. Visit admin settings: Site Settings → "allowed iframes"
2. Add domain to whitelist: `https://jacobeverist.github.io/dcc-public/`
3. Post iframe HTML in forum posts

---

## Network Architecture

### WASM Interface Layer

The WASM module exports a `WasmNetwork` class with methods for:

**Network Building**:
- `init_block(name)` - Add processing block
- `add_pattern_pooler(...)` - Add pooling layer
- `add_sequence_learner(...)` - Add sequence learning
- `add_context_learner(...)` - Add context processing
- `add_pattern_classifier(...)` - Add classification
- `add_scalar_transformer(...)` - Add scalar encoding
- `add_discrete_transformer(...)` - Add discrete encoding
- `build()` / `rebuild()` - Compile network
- `remove_block(name)` - Remove components

**Data Input/Output**:
- `encode_scalar(name, value)` - Feed scalar data
- `encode_scalars_batch(names[], values[])` - Batch processing
- `set_scalar_value(name, value)` - Set data source value
- `set_discrete_value(name, value)` - Set discrete input
- `get_probabilities(name)` - Read output probabilities
- `get_block_state(name)` - Query internal state

**Execution**:
- `execute(step_count)` - Run simulation steps
- `start_recording()` - Enable state capture
- `get_state_json()` - Export state
- `get_trace_json()` - Export execution trace

**Configuration**:
- `export_config()` / `import_config()` - Serialization
- `get_blocks_info()` - Query network structure

### React Component Hierarchy

Inferred structure:
```
App (Provider wrapper with ExecutionStore)
├── EmbeddableApp (main container)
│   ├── EmbeddableControls (control panel)
│   │   ├── Play/Stop/Step/Reset buttons
│   │   ├── Speed slider (with quadratic scaling)
│   │   └── Learning toggle
│   └── NetworkVisualization (React Flow?)
│       ├── Node rendering
│       ├── Edge rendering
│       └── Network interactions
└── Dashboard (v2 only)
    ├── Network view
    ├── Time-series charts
    └── Block state inspector
```

---

## State Management Architecture

### ExecutionStore (Zustand)
Controls simulation execution:
- `wasmNetwork` - WASM instance reference
- `wasmReady` - Module loaded flag
- `isRunning` - Execution state
- `executionStep` - Current step counter
- `speed` - Milliseconds per step
- `learningEnabled` - Learning on/off toggle
- `currentDemo` - Selected demo name
- `networkStatus` - "None" | "Running" | "Paused" | etc.

### NetworkStore
Manages network structure:
- `nodes[]` - Visualization nodes (with positions)
- `edges[]` - Connections between nodes
- `history[]` - Undo/redo stack (up to 50 items)
- Methods for node/edge CRUD and history management

### TimeSeriesStore
Tracks time-series data:
- `timeSeriesData{}` - Per-block data arrays
- Rolling history with `maxPoints` limit (typically 100)
- Batch update support for efficiency

### BitFieldStore
Binary state representation:
- `bitFieldData{}` - Per-block bitfield arrays
- `activeSet` - Set of active bit indices
- State preview for debugging

---

## Git History Insights

Recent development timeline:

```
9355f29 (Jan 7) updated vite build with relative path
67e7bae        manually fixed asset paths
0ebd1d9        updated dcc viewer with full dashboard and added encoder comparison demo
03664bd        changed default speed to 10Hz
bbdc214        updated README with simple scalar encoder demo
44c4bec        updated with simple scalar demo
4f79195        added Discourse instructions
...
1294d14        added initial version of embedded DCC viewer
3baaf2b        Initial commit
```

**Development Patterns**:
- Active maintenance on embedding and deployment
- V2 enhancements added progressively
- Focus on ease of embedding and usage documentation
- Speed/timing optimizations for better UX

---

## Deployment Details

### Hosting Platform
- **GitHub Pages** - Served from `https://jacobeverist.github.io/dcc-public/`
- **Static hosting** - No backend server required
- **HTTPS** - Secure by default with GitHub Pages

### Asset Serving
- All assets served as static files
- WASM module (`*.wasm`) served with appropriate MIME type
- JavaScript modules with ES module support
- CSS files with cache-busting hashes

### Performance Characteristics
- **WASM binary**: ~848 KB (gzipped compression reduces significantly)
- **JavaScript bundles**: ~2.1 MB for execution loop + UI
- **Total initial load**: ~3 MB per viewer (shared cache across versions)
- **Execution**: Native compiled performance with WebAssembly

---

## Development and Modification Notes

### Adding New Demos

To add a new demo (requires source code access):
1. Create demo configuration in source
2. Define network architecture (blocks and connections)
3. Set initial parameters and data sources
4. Run Vite build to generate new assets
5. Update viewer to recognize demo name
6. Test via `?demo=newDemoName` URL parameter

### Updating Dependencies

The compiled code includes:
- React 19.2.0
- Scheduler library for task prioritization
- Zustand for state management
- DOM utilities and React client adapters

Any dependency updates would require rebuilding from source.

### CSS Customization

Current styling is compiled into the CSS bundles. Modifications would require:
1. Access to source styles
2. Recompilation via Vite
3. Testing in embedded contexts

---

## Summary

This repository is a **distribution hub for DCC network visualization and simulation tools**. It contains:

- **Two versions** of an embedded viewer with increasing sophistication
- **Compiled web applications** built with React, Vite, and WebAssembly
- **Pre-built, ready-to-deploy assets** suitable for GitHub Pages and iframe embedding
- **Multi-demo system** supporting at least simpleEncoder, sequence, and encoderComparison
- **Sophisticated state management** for complex network visualizations
- **WASM-powered execution engine** for high-performance neural network simulation
- **Platform-independent distribution** through static hosting

The architecture emphasizes ease of embedding and integration into external platforms while maintaining high performance through WebAssembly for core computations.
