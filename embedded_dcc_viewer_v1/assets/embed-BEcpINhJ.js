import{u as t,r as i,d as f,e as W,f as q,h as y,j as s,P as B,t as H,$ as U,l as V,R as K,k as X,i as _,m as G,n as J,o as Q,c as E,N as Y,p as Z,q as ee}from"./useExecutionLoop-BnOGMAIv.js";function se({demoKey:p}){const a=t(e=>e.speed),b=t(e=>e.setSpeed),r=500,c=2,x=e=>{const l=e/100;return Math.round(Math.pow(l,c)*r)},h=e=>{const l=e/r;return Math.round(Math.pow(l,1/c)*100)},[w,j]=i.useState(h(a)),n=t(e=>e.isRunning),o=t(e=>e.wasmReady),S=t(e=>e.networkStatus),m=t(e=>e.learningEnabled);t(e=>e.executionStep),t(e=>e.currentDemo);const u=t(e=>e.start),N=t(e=>e.stop);t(e=>e.fullReset);const k=t(e=>e.destroyNetwork),v=t(e=>e.setWasmNetwork),C=t(e=>e.setSpeed),D=t(e=>e.toggleLearning),R=t(e=>e.singleStep),z=f(e=>e.nodes),L=f(e=>e.reset),P=W(e=>e.clearData),F=q(e=>e.clearData),{initializeDemo:M}=y(),d=z.length>0,$=()=>{!o||!d||u()},A=()=>{!o||!d||n||R()},I=()=>{N()},T=e=>{const l=parseInt(e.target.value);j(l);const g=x(l);b(g),C(g)},O=async()=>{if(!(!p||!o))try{if(S!=="None"){console.log("[EmbeddableControls] Destroying and recreating network..."),n&&N(),k(),L(),P(),F(),await new Promise(g=>setTimeout(g,50));const e=await V();if(!e){console.error("[EmbeddableControls] Failed to create new network");return}v(e),console.log("[EmbeddableControls] New network created successfully"),await M(p)?console.log("[EmbeddableControls] Demo reinitialized successfully"):console.error("[EmbeddableControls] Failed to reinitialize demo")}}catch(e){console.error("[EmbeddableControls] Error during reset:",e)}};return s.jsxs("div",{className:"embed-controls",children:[s.jsxs("div",{className:"embed-header",children:[s.jsx("div",{children:"Discrete Cortical Circuits (DCC) Simulator"}),s.jsx(B,{})]}),s.jsxs("div",{className:"embed-controls-bar",children:[s.jsxs("div",{className:"control-group",children:[s.jsx("button",{id:"start-btn",className:"primary",onClick:$,disabled:!o||!d||n,title:"Start continuous execution",children:"▶ Run"}),s.jsx("button",{id:"step-btn",className:"primary",onClick:A,disabled:!o||!d||n,title:"Execute single step",children:"⏭ Step"}),s.jsx("button",{className:H("control-btn","danger"),onClick:I,disabled:!n,title:"Stop execution",children:"⏸ Stop"}),s.jsx("button",{id:"reset-btn",className:"primary",onClick:O,disabled:!o||!d||n,title:"Reset network to initial state",children:"↺ Reset"}),s.jsx(U,{id:"learning-toggle",className:({isSelected:e})=>e?"primary":"danger",isSelected:m,onChange:D,isDisabled:!o||!d||n,children:({isSelected:e})=>e?"Learning On":"Learning Off"})]}),s.jsxs("div",{className:"control-group",children:[s.jsx("label",{children:"Speed"}),s.jsx("input",{type:"range",id:"speed-slider",min:"0",max:"100",value:w,onChange:T,title:`${a}ms (quadratic scale)`,style:{direction:"rtl"}}),s.jsx("span",{id:"speed-display",style:{color:"var(--text-primary)"},children:a==0?"max speed":(1/(a/1e3)).toFixed(1)+" steps/s"})]})]})]})}function te(){const{getNodes:p}=X(),[a,b]=i.useState(null),[r,c]=i.useState(null),{applyElkDefault:x}=_(),h=G({includeHiddenNodes:!0}),[w,j]=i.useState(p());J(),Q();const n=t(m=>m.wasmReady),{initializeDemo:o}=y();i.useEffect(()=>{const u=new URLSearchParams(window.location.search).get("demo")||"sequence";if(!E[u]){b(`Invalid demo: "${u}". Available demos: ${Object.keys(E).join(", ")}`),c(null);return}c(u),b(null)},[]),i.useEffect(()=>{h&&x()},[h]),i.useEffect(()=>{n&&r&&!a&&(console.log(`[EmbeddableApp] Initializing demo: ${r}`),o(r).then(()=>{console.log("Demo initialized successfully")},()=>{console.log("Failed to initialize demo")}))},[n,r,a,o]);const S={padding:.1};return a?s.jsx("div",{className:"embed-container",children:s.jsxs("div",{className:"embed-error",children:[s.jsx("h2",{children:"Error Loading Demo"}),s.jsx("p",{children:a}),s.jsxs("p",{className:"error-hint",children:["Try adding a valid demo parameter to the URL, e.g., ",s.jsx("code",{children:"?demo=sequence"})]})]})}):n?s.jsxs("div",{className:"embed-container",children:[s.jsx(se,{demoKey:r}),s.jsx("div",{className:"embed-network-wrapper",children:s.jsx(Y,{fitViewOptions:S})})]}):s.jsx("div",{className:"embed-container",children:s.jsxs("div",{className:"embed-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Loading WASM module..."})]})})}function ne(){return s.jsx(K,{children:s.jsx(te,{})})}Z();ee.createRoot(document.getElementById("root")).render(s.jsx(i.StrictMode,{children:s.jsx(ne,{})}));
