import{u as t,r as m,b as w,d as U,e as H,f as k,j as s,c as g,k as K,R as X,l as _,m as G,a as E,N as J,n as Q}from"./useExecutionLoop-rW8aItqV.js";function Y({demoKey:a}){const r=t(e=>e.speed),o=t(e=>e.setSpeed),u=500,c=2,x=e=>{const n=e/100;return Math.round(Math.pow(n,c)*u)},j=e=>{const n=e/u;return Math.round(Math.pow(n,1/c)*100)},[p,h]=m.useState(j(r)),d=t(e=>e.isRunning),i=t(e=>e.wasmReady),f=t(e=>e.networkStatus),v=t(e=>e.learningEnabled),y=t(e=>e.executionStep),N=t(e=>e.currentDemo),C=t(e=>e.start),S=t(e=>e.stop),R=t(e=>e.reset),D=t(e=>e.destroyNetwork),M=t(e=>e.setWasmNetwork),P=t(e=>e.setSpeed),z=t(e=>e.toggleLearning),L=t(e=>e.singleStep),A=w(e=>e.nodes),F=w(e=>e.reset),T=U(e=>e.clearData),W=H(e=>e.clearData),{initializeDemo:$}=k(),l=A.length>0,I=()=>{!i||!l||C()},O=()=>{S()},q=async()=>{if(!(!a||!i))try{if(d&&S(),f!=="None"){console.log("[EmbeddableControls] Destroying and recreating network..."),D(),F(),T(),W(),R(),await new Promise(b=>setTimeout(b,50));const n=await K();if(!n){console.error("[EmbeddableControls] Failed to create new network");return}M(n),console.log("[EmbeddableControls] New network created successfully")}await $(a)?console.log("[EmbeddableControls] Demo reinitialized successfully"):console.error("[EmbeddableControls] Failed to reinitialize demo")}catch(e){console.error("[EmbeddableControls] Error during reset:",e)}},B=e=>{const n=parseInt(e.target.value);h(n);const b=x(n);o(b),P(b)},V=()=>{!i||!l||d||L()};return s.jsxs("div",{className:"embed-controls",children:[s.jsxs("div",{className:"embed-header",children:[s.jsxs("div",{className:"embed-title",children:[s.jsx("h2",{children:"DCC Network Viewer"}),N&&s.jsx("span",{className:"demo-name",children:N})]}),s.jsxs("div",{className:"embed-status",children:[s.jsx("div",{className:g("status-dot",{active:i}),title:"WASM Status"}),s.jsxs("span",{className:"step-counter",children:["Step: ",y]})]})]}),s.jsxs("div",{className:"embed-controls-bar",children:[s.jsxs("div",{className:"control-group",children:[s.jsx("button",{className:g("control-btn","primary"),onClick:I,disabled:!i||!l||d,title:"Start continuous execution",children:"â–¶ Start"}),s.jsx("button",{className:g("control-btn","danger"),onClick:O,disabled:!d,title:"Stop execution",children:"â¸ Stop"}),s.jsx("button",{className:"control-btn",onClick:V,disabled:!i||!l||d,title:"Execute single step",children:"â­ Step"}),s.jsx("button",{className:"control-btn",onClick:q,disabled:!i||!l||d,title:"Reset network to initial state",children:"ðŸ”„ Reset"})]}),s.jsx("div",{className:"control-group",children:s.jsxs("label",{className:"speed-control",children:[s.jsx("span",{children:"Speed:"}),s.jsx("input",{type:"range",min:"0",max:"100",value:p,onChange:B,title:`${r}ms (quadratic scale)`,style:{direction:"rtl"},disabled:!l}),s.jsxs("span",{className:"speed-value",children:[r,"ms"]})]})}),s.jsx("div",{className:"control-group",children:s.jsxs("label",{className:"learning-toggle",children:[s.jsx("input",{type:"checkbox",checked:v,onChange:z,disabled:!l}),s.jsx("span",{children:"Learning"})]})})]})]})}function Z(){const[a,r]=m.useState(null),[o,u]=m.useState(null);_(),G();const c=t(p=>p.wasmReady),{initializeDemo:x}=k();m.useEffect(()=>{const h=new URLSearchParams(window.location.search).get("demo")||"sequence";if(!E[h]){r(`Invalid demo: "${h}". Available demos: ${Object.keys(E).join(", ")}`),u(null);return}u(h),r(null)},[]),m.useEffect(()=>{c&&o&&!a&&(console.log(`[EmbeddableApp] Initializing demo: ${o}`),x(o)||r(`Failed to initialize demo: ${o}`))},[c,o,a,x]);const j={padding:.1};return a?s.jsx("div",{className:"embed-container",children:s.jsxs("div",{className:"embed-error",children:[s.jsx("h2",{children:"Error Loading Demo"}),s.jsx("p",{children:a}),s.jsxs("p",{className:"error-hint",children:["Try adding a valid demo parameter to the URL, e.g., ",s.jsx("code",{children:"?demo=sequence"})]})]})}):c?s.jsxs("div",{className:"embed-container",children:[s.jsx(Y,{demoKey:o}),s.jsx("div",{className:"embed-network-wrapper",children:s.jsx(J,{fitViewOptions:j})})]}):s.jsx("div",{className:"embed-container",children:s.jsxs("div",{className:"embed-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Loading WASM module..."})]})})}function ee(){return s.jsx(X,{children:s.jsx(Z,{})})}Q.createRoot(document.getElementById("root")).render(s.jsx(m.StrictMode,{children:s.jsx(ee,{})}));
